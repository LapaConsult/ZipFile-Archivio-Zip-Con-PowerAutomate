# ZipFile-Archivio-Zip-Con-PowerAutomate
> [!IMPORTANT] al Feb 2024 non esiste un connettore standard in PowerAutomate per elaborare un archivio Zip
### Ci sono Sostanzialmente 2 metodi
1. [Creare una Funzione Azure da richiamare in PowerAutomate](https://www.damobird365.com/how-to-setup-an-azure-function-to-zip-files/) : Preferisco questa perche anche se a pagamento [potresti non pagare mai](https://azure.microsoft.com/en-us/pricing/details/functions/?ef_id=_k_CjwKCAiAiP2tBhBXEiwACslfngnkqM2FjwVhoYTkYoRoXCNvQb7FdA6gDGzWt5JfOayar4jP7EF49RoC724QAvD_BwE_k_&OCID=AIDcmmy6frl1tq_SEM__k_CjwKCAiAiP2tBhBXEiwACslfngnkqM2FjwVhoYTkYoRoXCNvQb7FdA6gDGzWt5JfOayar4jP7EF49RoC724QAvD_BwE_k_&gad_source=1&gclid=CjwKCAiAiP2tBhBXEiwACslfngnkqM2FjwVhoYTkYoRoXCNvQb7FdA6gDGzWt5JfOayar4jP7EF49RoC724QAvD_BwE )
2. [Usare una tattica Sharepoint](https://www.tachytelic.net/2021/07/power-automate-create-zip-file/) : Questa tattica usa il connettore standard HTTP Sharepoint in PowerAutomate quindi "Gratis"

> [!WARNING] Da notare pero che la dimensione dello zip non deve superare 200 MB se usi l'opzione 1 dell'azure Function e 100 mb se usi la seconda opzione HTTP Request di Sharepoint.

 ## Insieme di azioni dopo il Trigger con metodo Azure Function
 ```
{"id":"463cf974-2050-493b-8f14-0635053be779","brandColor":"#8C3900","connectionReferences":{"shared_onedriveforbusiness":{"connection":{"id":"/providers/Microsoft.PowerApps/apis/shared_onedriveforbusiness/connections/0d2d1eb3993247bb9a5b21eba6e0e1b2"}},"shared_azureblob-5":{"connection":{"id":"/providers/Microsoft.PowerApps/apis/shared_azureblob/connections/shared-azureblob-dbb521d7-4766-4622-be86-2f251cc72f7b"}}},"connectorDisplayName":"Controllo","icon":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KIDxwYXRoIGQ9Im0wIDBoMzJ2MzJoLTMyeiIgZmlsbD0iIzhDMzkwMCIvPg0KIDxwYXRoIGQ9Im04IDEwaDE2djEyaC0xNnptMTUgMTF2LTEwaC0xNHYxMHptLTItOHY2aC0xMHYtNnptLTEgNXYtNGgtOHY0eiIgZmlsbD0iI2ZmZiIvPg0KPC9zdmc+DQo=","isTrigger":false,"operationName":"Ambito","operationDefinition":{"type":"Scope","actions":{"Elenca_i_BLOB_(V2)":{"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_azureblob-5","operationId":"ListFolder_V4","apiId":"/providers/Microsoft.PowerApps/apis/shared_azureblob"},"parameters":{"dataset":"demoblobcreate","id":"JTJmZGVtb2NvbnRhaW5lcg==","nextPageMarker":"","useFlatListing":false},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}},"runAfter":{},"metadata":{"JTJmZGVtb2NvbnRhaW5lcg==":"/democontainer","operationMetadataId":"77a9ba69-b2ec-4f96-9eb0-9f98eba1eac5"}},"For_each":{"type":"Foreach","foreach":"@outputs('Elenca_i_BLOB_(V2)')?['body/value']","actions":{"Recupera_contenuto_BLOB_(V2)":{"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_azureblob-5","operationId":"GetFileContent_V2","apiId":"/providers/Microsoft.PowerApps/apis/shared_azureblob"},"parameters":{"dataset":"AccountNameFromSettings","id":"@items('For_each')?['Id']","inferContentType":false},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}},"runAfter":{"Componi_1":["Succeeded"]},"metadata":{"JTJmZGVtb2NvbnRhaW5lciUyZjEwMG1iX2ZpbGVfMS5iaW4=":"/democontainer/100mb_file_1.bin","operationMetadataId":"2fccb445-3593-4176-8e60-3d0baa4a4f99"}},"Componi_1":{"type":"Compose","inputs":"@items('For_each')?['Name']","runAfter":{},"metadata":{"operationMetadataId":"9ac87801-f798-42f6-b168-d8d17e59c149"}},"Componi":{"type":"Compose","inputs":{"FileName":"@{items('For_each')?['Name']}","FileContent":"@{base64(body('Recupera_contenuto_BLOB_(V2)')?['$content'])}"},"runAfter":{"Recupera_contenuto_BLOB_(V2)":["Succeeded"]},"metadata":{"operationMetadataId":"80d2cc39-9d85-4781-a966-82143279fcb4"}}},"runAfter":{"Elenca_i_BLOB_(V2)":["Succeeded"]},"metadata":{"operationMetadataId":"10abb2ff-1de1-4fa8-a2a0-461d5c9e6cb3"}},"HTTP":{"type":"Http","inputs":{"method":"POST","uri":"https://ariszipfiles.azurewebsites.net/api/ZipFiles?code=dEYTer0Z2_ucrTf0ou_dxtVo6mrGVxKcoPdDAIFGtY3_AzFuN4eFeg==","body":"@Outputs('Componi')"},"runAfter":{"For_each":["Succeeded"]},"metadata":{"operationMetadataId":"3b13bd37-ce5d-4687-927b-389cc5ae32e1"}},"Crea_file":{"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_onedriveforbusiness","operationId":"CreateFile","apiId":"/providers/Microsoft.PowerApps/apis/shared_onedriveforbusiness"},"parameters":{"folderPath":"/aZip_Demo/Zippato","name":"lapaconsult.zip","body":"@body('HTTP')"},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}},"runAfter":{"HTTP":["Succeeded"]},"metadata":{"operationMetadataId":"e880187f-6a25-4868-97ef-1af95ebba995"}}},"runAfter":{},"metadata":{"operationMetadataId":"960e1418-1380-4ac0-bd9d-0837c4505697"}}}

```
